* Feature
** Shop
*** TODO Homepage
*** TODO Register page
*** TODO Login/logout page
*** TODO Yesod tests
** Database
*** TODO Create
*** TODO Setup indexes
*** TODO Encrypt data at rest?
*** TODO Versioning?
** Organizer
** TODO List documents
** TODO Create document
** TODO Delete document
** TODO Rename
** UI
*** TODO [#A] Re-use code instead of result for other array items
Repro:
[1, x] where x = 2 * 3
Changing 1 => 3 should not replace x with 6.
*** TODO [#B] Ability to edit names of decls
*** TODO [#B] "New" button
** Engine
*** TODO Question-mark for results/optionals?
*** TODO Consider partial arithmetic similar to x * y :: Result Error Int
Be bold!

(but limited in memory use eventually)
Integer - arbitrary size   - total operations
Rational - arbitrary size  - total operations

(re-use safe-decimal package)
Int64 - fixed precision    - partial operations
Decimal - fixed precision  - partial operations

Int32/Int16/Int8

Use floating points but make partial results explicit too?

*** TODO [#A] Add Rows
- [ ] Write Duet->PS converter
- [ ] Add test suite that checks compile(duet(x))==compile(ps(x))
- [ ] Add row types to Duet
- [ ] Use test suite to test this
- [ ] Add RowE display to Editor for row types
- [ ] Add TableE (Vector (r :: Row)) display to Editor sum type
*** TODO [#C] Add TextE for String typed expressions
*** DONE [#A] Add Array
    CLOSED: [2020-03-14 Sat 16:27]
    - State "DONE"       from "TODO"       [2020-03-14 Sat 16:27]
   - Note taken on [2020-03-06 Fri 17:54] \\
     This will serve as a warm up for the Duet, for implementing row types.
   - Note taken on [2020-03-06 Fri 17:41] \\
     Work in progress. Needs inference for Array type.

e.g. data Array (a :: Type)
- [X] Add a Array type to Duet
- [X] Add inference for Array type
- [X] Add stepper for Array
- [X] Add a Array display to Editor sum type

#+BEGIN_SRC
[1,2,3]
=>
| 1 |
| 2 |
| 3 |
#+END_SRC
*** DONE Make sum type of results
   CLOSED: [2020-03-06 Fri 17:15]
   - Note taken on [2020-03-06 Fri 17:15] \\
     Made Editor type.

     #+BEGIN_SRC
     data Editor
       = IntegerE Integer
       -- | RationalE Rational
       -- | TextE Text
       -- | RecordE (HashMap Text Editor)
       -- | TableE (Array Text) (Array (HashMap Text Editor))
       | MiscE Text
       deriving (Show)
     #+END_SRC
   - State "DONE"       from "TODO"       [2020-03-06 Fri 17:15]
- [ ] Number
- [ ] List of numbers
- [ ] Table
- [ ] Text
*** DONE Get input value from Dec input
    CLOSED: [2020-02-29 Sat 15:27]
    - State "DONE"       from "TODO"       [2020-02-29 Sat 15:27]
*** DONE Make Haskell server load at runtime the app.js
    CLOSED: [2020-02-24 Mon 16:15]
    - State "DONE"       from "TODO"       [2020-02-24 Mon 16:15]
* Duet
** TODO [#A] Implement CAS name generation
- [ ] de Brujin index
- [ ] mutually recursive groups are rewritten into one

Quoting Unison:

#+BEGIN_QUOTE
A term or type definition that’s part of a cycle of mutually recursive
definitions hashes to the form #x.n where x is the hash of the cycle
and n is the term or type’s index in its cycle. A cycle has a
canonical order determined by sorting all the members of the cycle by
their individual hashes (with the cycle removed).
#+END_QUOTE
** TODO [#A] Need better GenUnchecked instances for names
** TODO [#C] Convert to trees that grow
** TODO [#B] Delete Alts and such
* Testing
  - Note taken on [2020-03-07 Sat 11:29] \\
    https://hackage.haskell.org/package/validity-0.9.0.3/docs/src/Data.Validity.html#trivialValidation
  - Note taken on [2020-03-07 Sat 11:26] \\
    #+BEGIN_QUOTE
    syd
    have you tried producesValidsOnValids?
    it's basically totality testing
    #+END_QUOTE
** TODO hspec-yesod to test shop
** TODO nodejs benchmark frontend
** TODO nodejs PureScript to unit test
** TODO Use PureScript to validity test QuickCheck generate code
- [ ] Should compile vs shouldn't -- if it compiles in PS implies it
  compiles in Duet
* Bugs
** UI
*** TODO [#C] Autoresize input to match content length
*** DONE [#C] Autofocus when starting the editor
    CLOSED: [2020-03-15 Sun 00:16]
    - State "DONE"       from "BLOCKED"    [2020-03-15 Sun 00:16]
    - State "BLOCKED"    from "TODO"       [2020-03-14 Sat 16:27] \\
      Waiting on answer.
    - Note taken on [2020-03-14 Sat 16:26] \\
      Asked question here:

      https://github.com/purescript-halogen/purescript-halogen/issues/646
* Supportive
** DONE Use psc-package-fast
   CLOSED: [2020-02-24 Mon 13:29]
   - State "DONE"       from "TODO"       [2020-02-24 Mon 13:29]
   - Note taken on [2020-02-24 Mon 13:29] \\
     Opened PR

     https://github.com/bitc/purescript-bundle-fast/pull/2

** DONE Put .psc-package in /dev/shm to avoid thrashing
   CLOSED: [2020-02-24 Mon 13:29]
   - State "DONE"       from "TODO"       [2020-02-24 Mon 13:29]

* Considerations
** TODO Make WAI only approve /health?token=SPECIALTOKENHERE
   - Note taken on [2020-04-04 Sat 13:41] \\
     https://www.digitalocean.com/community/questions/how-to-set-a-ip-restriction-on-nodeport-range-of-do-managed-kubernetes?comment=86684
** TODO Username/organization blacklists!
https://www.quora.com/How-do-sites-prevent-vanity-URLs-from-colliding-with-future-features/answer/Kyle-Neath
** TODO GDPR
** TODO The cookies spiel - needed before register/login page?
** TODO Sending emails?
** TODO Cache-control to make shop faster
** TODO Server-side PureScript
   - Note taken on [2020-03-06 Fri 16:20] \\
     Use nodejs for now?
   - Note taken on [2020-03-06 Fri 16:17] \\
     SpiderMonkey probably quite stable?
   - Note taken on [2020-03-05 Thu 09:37] \\
     V8 binary:

     #+BEGIN_SRC
     console.log('waiting');
     setTimeout(function(){
     console.log('hi');
     }, 1000 * 3);
     console.log('me first');
     $ ./d8 test.js
     waiting
     me first
     hi
     #+END_SRC
   - Note taken on [2020-03-05 Thu 09:37] \\
     Investigation into Duktape: https://github.com/svaarala/duktape/issues/2241
   - Note taken on [2020-03-04 Wed 15:26] \\
     Use one of these binaries?

     https://bellard.org/quickjs/bench.html

     NodeJS doesn't have a DOM anyway!
*** DONE Review hs-duktape [NOT GOOD]
    CLOSED: [2020-03-04 Wed 11:03]
    - State "DONE"       from "TODO"       [2020-03-04 Wed 11:03]
    - Note taken on [2020-03-04 Wed 11:02] \\
      Not very satisfying:

      https://github.com/myfreeweb/hs-duktape/issues/11
      https://github.com/myfreeweb/hs-duktape/issues/10
    - Note taken on [2020-03-04 Wed 11:01] \\
      https://github.com/myfreeweb/hs-duktape/pull/7/files
    - Note taken on [2020-03-04 Wed 10:47] \\
      https://github.com/svaarala/duktape/issues/1853
    - Note taken on [2020-03-04 Wed 10:31] \\
      https://github.com/myfreeweb/hs-duktape/commit/931f5da36454bfb9c6231333f82b14265fb226c8#r37628869
    - Note taken on [2020-03-04 Wed 10:31] \\
      https://github.com/myfreeweb/hs-duktape/commit/68b2ea59fb9c708362007acdc5cb35aca2b0d365
* Competition
** Notebooks
   - Note taken on [2020-03-07 Sat 16:51] \\
     What’s Wrong with Computational Notebooks?
     Pain Points, Needs, and Design Opportunities
     https://web.eecs.utk.edu/~azh/pubs/Chattopadhyay2020CHI_NotebookPainpoints.pdf
* Research
  - Note taken on [2020-03-26 Thu 09:33] \\
    https://www.unisonweb.org/
  - Note taken on [2020-03-26 Thu 09:33] \\
    https://www.reddit.com/r/haskell/comments/fov9gt/closure_calculus_is_better_than_the_pure_%CE%BBcalculus/fljg9fb/
* Mantras
** UI failures
- Scroll within scroll
- Focus stealing
* DigitalOcean
  - Note taken on [2020-04-04 Sat 10:29] \\
    Load balancer name issue:

    https://cloudsupport.digitalocean.com/s/my-tickets
  - Note taken on [2020-03-29 Sun 18:11] \\
    Consider e.g. rancher or coreos - a way to spin up a droplet with a
    single file like "run this docker image".
  - Note taken on [2020-03-29 Sun 17:45] \\
    Got a basic deploy working with DO's load balancer (with HTTPS), a
    single droplet (a heavy full ubuntu machine with docker-machine on
    it).

    Deploy step is basically:

    docker-machine up -d

    And we change the docker image to something else to deploy a new instance.
  - Note taken on [2020-03-29 Sun 17:10] \\
    Via docker-machine:

    time docker-machine create   --driver digitalocean   --digitalocean-access-token $(cat ~/.do-token)   --digitalocean-monitoring   --digitalocean-region "lon1"   --digitalocean-size "s-1vcpu-1gb" inflex-server
  - Note taken on [2020-03-29 Sun 12:36] \\
    Looks like this guy has it right:

    https://www.digitalocean.com/community/questions/kubernetes-deployment-with-external-load-balancer-zero-downtime-rollouts
- [ ] Proxying http://hackage.haskell.org/package/warp-3.3.9/docs/Network-Wai-Handler-Warp.html#v:setProxyProtocolRequired
#+BEGIN_SRC
chris@precision:~$ doctl auth init
Please authenticate doctl for use with your DigitalOcean account. You can generate a token in the control panel at https://cloud.digitalocean.com/account/api/token

Enter your access token:
Validating token... OK

chris@precision:~$ doctl kubernetes cluster kubeconfig save inflex-server
Notice: Adding cluster credentials to kubeconfig file found in "/home/chris/.kube/config"
Notice: Setting current-context to do-lon1-inflex-server
chris@precision:~$
#+END_SRC
