* Go live checklist
- [ ] Stripe checkout
- [ ] Stripe portal working
- [ ] Google Analytics setup with Measurement protocol
- [ ] T's & C's
- [ ] Privacy policy
- [ ] Refunds policy
- [ ] Database backups policy
- [ ] Encryption of data at rest?
- [ ] Custom user-friendly error handlers: 500, 400
* Data protection office
  - Note taken on [2020-07-17 Fri 11:09] \\
    https://ico.org.uk/for-organisations/data-protection-fee/next/
* Stripe
  - Note taken on [2020-06-28 Sun 22:15] \\
    Premium support starts at £1400/mo

    https://stripe.com/gb/support-and-services?utm_campaign=premiumsupport_m4&utm_source=pricing2&utm_medium=support-faq
  - Note taken on [2020-06-15 Mon 16:34] \\
    Sending email reminders https://stripe.com/docs/billing/invoices/paying#emails
* Feature
** Shop
*** TODO Homepage
*** TODO Yesod tests
** Database
*** TODO Setup indexes
*** TODO Encrypt data at rest?
*** TODO Versioning?
** Organizer
** TODO Delete document
** TODO Rename
** UI
*** TODO [#B] Move arbitrarily
*** TODO [#B] Rename documents
*** TODO [#A] Re-use code instead of result for other array items
Repro:
[1, x] where x = 2 * 3
Changing 1 => 3 should not replace x with 6.
*** TODO Canvas/rendering?
    - Note taken on [2020-05-02 Sat 12:05] \\
      Mandelbrot in Excel https://slicker.me/fractals/excel.htm

      Make an equivalent in Inflex to show its speed/power?
*** TODO Code mirror?
    - Note taken on [2020-05-02 Sat 12:05] \\
      https://github.com/chrisdone/codeparty/blob/master/src/Halogen/CodeMirror.purs
** Engine
*** TODO Question-mark for results/optionals?
*** TODO Consider partial arithmetic similar to x * y :: Result Error Int
Be bold!

(but limited in memory use eventually)
Integer - arbitrary size   - total operations
Rational - arbitrary size  - total operations

(re-use safe-decimal package)
Int64 - fixed precision    - partial operations
Decimal - fixed precision  - partial operations

Int32/Int16/Int8

Use floating points but make partial results explicit too?
*** TODO [#C] Add TextE for String typed expressions
* Running
  - Note taken on [2020-06-20 Sat 23:20] \\
    In Rust? https://github.com/chrisdone/redex/blob/f82c4a727321b11074d50734c09a23fdc1c9cb13/src/main.rs#L1
* Logging/metrics

* Analytics
  - Note taken on [2020-06-17 Wed 16:20] \\
    GA measurement protocol

    https://developers.google.com/analytics/devguides/collection/protocol/v1/devguide
  - Note taken on [2020-06-17 Wed 15:48] \\
    Server-side google analytics to track traffic

    https://cloud.google.com/appengine/docs/standard/java/google-analytics
* Perf
  - Note taken on [2020-06-24 Wed 11:55] \\
    Brotli instead of gzip encoding?
  - Note taken on [2020-06-17 Wed 15:42] \\
    Pageviews from HN:
    https://web.archive.org/web/20140626150005/http://blog.talles.me/my-hacker-news-front-page-day.html
    https://news.ycombinator.com/item?id=8107658
  - Note taken on [2020-06-02 Tue 10:42] \\
    Consider parallel stuff in compiler?

    http://hackage.haskell.org/package/parallel-3.2.2.0/docs/Control-Parallel-Strategies.html
** TODO Cache-control to make shop faster
   - Note taken on [2020-05-03 Sun 12:21] \\
     immutible -- still relevant for Firefox/Safari/Edge. Not relevant
     for Chrome.
* Testing
** TODO Use Chromium headless for JS tests?
   - Note taken on [2020-06-17 Wed 11:30] \\
     https://developers.google.com/web/updates/2017/04/headless-chrome
   - Note taken on [2020-06-17 Wed 11:20] \\
     In Docker https://github.com/Zenika/alpine-chrome
** TODO Use GHC/PS to validity test compiler
   - Note taken on [2020-06-02 Tue 10:44] \\
     - Note taken on [2020-03-07 Sat 11:29] \\
         https://hackage.haskell.org/package/validity-0.9.0.3/docs/src/Data.Validity.html#trivialValidation
       - Note taken on [2020-03-07 Sat 11:26] \\
         #+BEGIN_QUOTE
         syd
         have you tried producesValidsOnValids?
         it's basically totality testing
         #+END_QUOTE
** TODO hspec-yesod to test shop
** TODO nodejs benchmark frontend
** TODO nodejs PureScript to unit test
** TODO Use PureScript to validity test QuickCheck generate code
- [ ] Should compile vs shouldn't -- if it compiles in PS implies it
  compiles in Duet
* Bugs
** UI
*** TODO [#C] Autoresize input to match content length
*** DONE [#C] Autofocus when starting the editor
    CLOSED: [2020-03-15 Sun 00:16]
    - State "DONE"       from "BLOCKED"    [2020-03-15 Sun 00:16]
    - State "BLOCKED"    from "TODO"       [2020-03-14 Sat 16:27] \\
      Waiting on answer.
    - Note taken on [2020-03-14 Sat 16:26] \\
      Asked question here:

      https://github.com/purescript-halogen/purescript-halogen/issues/646
* Supportive
* Considerations
** TODO Brotli compression
   - Note taken on [2020-07-02 Thu 16:29] \\
     brotli vs gzip, an improvement

     #+BEGIN_SRC
     chris@precision:~/Work/skyabove/inflex/inflex-client$ ls -alh app.js*
     -rw-rw-r-- 1 chris chris 490K Jun 28 15:05 app.js
     -rw-rw-r-- 1 chris chris  95K Jun 30 15:11 app.js.br.1
     -rw-rw-r-- 1 chris chris  59K Jun 30 15:11 app.js.br.9
     -rw-rw-r-- 1 chris chris  54K Jun 30 15:12 app.js.br.default
     -rw-rw-r-- 1 chris chris  54K Jun 30 15:18 app.js.br.z
     -rw-rw-r-- 1 chris chris  94K Jun 30 15:11 app.js.gz.1
     -rw-rw-r-- 1 chris chris  66K Jun 30 15:11 app.js.gz.9
     #+END_SRC
** TODO Beginner Programming is hard because inputting values is hard
   - Note taken on [2020-07-02 Thu 12:23] \\
     Case in point:

     https://www.reddit.com/r/haskell/comments/hjratt/beginner_haskell_question_concerning_read_and_show/

     In Inflex this would be much easier.
** TODO Mutual recursive definitions? Yep!
   - Note taken on [2020-06-24 Wed 17:13] \\
     Needed, due to this kind of algorithm:

     #+BEGIN_SRC python
     def f_tree(tree) -> None:
         f_value(tree.value)
         f_forest(tree.children)

     def f_forest(forest) -> None:
         for tree in forest:
             f_tree(tree)
     #+END_SRC

** TODO Logic language feature?
   - Note taken on [2020-06-24 Wed 14:00] \\
     It's often that you have some numbers and constraints and you want to
     "fill in" potential solutions.

     SMT?
   - Note taken on [2020-06-24 Wed 14:00] \\
     https://fpcomplete-my.sharepoint.com/:x:/r/personal/chrisdone_fpcomplete_com/_layouts/15/Doc.aspx?sourcedoc=%7BA16D446C-99A4-495C-9571-6045B9BDDC5E%7D&file=Book%202.xlsx&action=editnew&mobileredirect=true&wdNewAndOpenCt=1593001848450&wdPreviousSession=6222750b-3cb5-4f2d-ae25-47b238218b0f&wdOrigin=OFFICECOM-WEB.START.NEW
     Example use case
** TODO "Continued" expressions -- (re-vision pivot table)
An easy way to do a transformation step by step:

E.g. pivot table:

1. Group by row. [[{p:red,d:2020,v:1},{p:red,d:2021,v:2}], ..]
2. Group by column. [[{p:red,d:2020,v:1},{p:red,d:2020,v:2}], ..]]
3. Fold over data field. [{p:red,cols:[{c:2020,vs: [ ] }]}]

Then it's very easy to see the intermediate steps, and suddenly a
pivot table isn't so magical and is just another data transformation.

** TODO Add a session garbage collector
** TODO Supporting Dex+SAML for Azure/Google?
** TODO Put CSRF protection into forms?
** TODO When linking across documents
Granularity of changes accepted automatically:
- Accept renames
- Accept data changes
- Accept behavior changes
- Accept type changes -- important, because may fail to compile!
- Accept changes if they type check
- Accept changes if they pass a given test suite
** TODO Consistent use of "input" and "output"
As inputs to functions, as opposed to e.g. "param" or "argument",

or "returns" which is a very imperative term!!
** TODO Lazy display of [infinite] data
** TODO Use streaming JSON parsers (defensive)
   - Note taken on [2020-04-11 Sat 23:42] \\
     https://github.com/chrisdone/streaming-parsers
** TODO Make WAI only approve of local subnet
   - Note taken on [2020-04-04 Sat 13:41] \\
     https://www.digitalocean.com/community/questions/how-to-set-a-ip-restriction-on-nodeport-range-of-do-managed-kubernetes?comment=86684
** TODO Username/organization blacklists!
https://www.quora.com/How-do-sites-prevent-vanity-URLs-from-colliding-with-future-features/answer/Kyle-Neath
** TODO GDPR
** TODO Sending emails?
** DONE The cookies spiel - needed before register/login page?
   CLOSED: [2020-04-14 Tue 11:42]
   - State "DONE"       from "TODO"       [2020-04-14 Tue 11:42]
   - Note taken on [2020-04-14 Tue 11:41] \\
     We can also just use server-side analysis with digital fingerprints to
     track people/funnelling. No cookies required.
   - Note taken on [2020-04-14 Tue 11:41] \\
     Nope - not needed for registration/signup.
** TODO Server-side PureScript
   - Note taken on [2020-03-06 Fri 16:20] \\
     Use nodejs for now?
   - Note taken on [2020-03-06 Fri 16:17] \\
     SpiderMonkey probably quite stable?
   - Note taken on [2020-03-05 Thu 09:37] \\
     V8 binary:

     #+BEGIN_SRC
     console.log('waiting');
     setTimeout(function(){
     console.log('hi');
     }, 1000 * 3);
     console.log('me first');
     $ ./d8 test.js
     waiting
     me first
     hi
     #+END_SRC
   - Note taken on [2020-03-05 Thu 09:37] \\
     Investigation into Duktape: https://github.com/svaarala/duktape/issues/2241
   - Note taken on [2020-03-04 Wed 15:26] \\
     Use one of these binaries?

     https://bellard.org/quickjs/bench.html

     NodeJS doesn't have a DOM anyway!
*** DONE review duktape [GOOD]
*** DONE Review hs-duktape [NOT GOOD]
    CLOSED: [2020-03-04 Wed 11:03]
    - State "DONE"       from "TODO"       [2020-03-04 Wed 11:03]
    - Note taken on [2020-03-04 Wed 11:02] \\
      Not very satisfying:

      https://github.com/myfreeweb/hs-duktape/issues/11
      https://github.com/myfreeweb/hs-duktape/issues/10
    - Note taken on [2020-03-04 Wed 11:01] \\
      https://github.com/myfreeweb/hs-duktape/pull/7/files
    - Note taken on [2020-03-04 Wed 10:47] \\
      https://github.com/svaarala/duktape/issues/1853
    - Note taken on [2020-03-04 Wed 10:31] \\
      https://github.com/myfreeweb/hs-duktape/commit/931f5da36454bfb9c6231333f82b14265fb226c8#r37628869
    - Note taken on [2020-03-04 Wed 10:31] \\
      https://github.com/myfreeweb/hs-duktape/commit/68b2ea59fb9c708362007acdc5cb35aca2b0d365
* Competition
** Lobstrs discussion
   - Note taken on [2020-06-18 Thu 14:11] \\
     Loglo https://lobste.rs/s/lrj6mh/loglo_spreadsheet_using_stack_language
   - Note taken on [2020-05-12 Tue 17:59] \\
     TreeSheets https://lobste.rs/s/7catij/how_do_you_take_notes_organize_your#c_kxntgo
** TreeSheets
   - Note taken on [2020-05-12 Tue 17:30] \\
     http://strlen.com/treesheets/
** Notebooks
   - Note taken on [2020-03-07 Sat 16:51] \\
     What’s Wrong with Computational Notebooks?
     Pain Points, Needs, and Design Opportunities
     https://web.eecs.utk.edu/~azh/pubs/Chattopadhyay2020CHI_NotebookPainpoints.pdf
* Research
  - Note taken on [2020-06-23 Tue 11:36] \\
    Graphs: https://vega.github.io/vega-lite/
    Charts: https://www.chartjs.org/
  - Note taken on [2020-06-15 Mon 17:16] \\
    SMS: https://www.twilio.com/pricing
  - Note taken on [2020-05-19 Tue 09:32] \\
    PureScript got field names right, Haskell got them wrong
    https://tek.brick.do/ff3d4f73-3748-4953-b9dc-4ba8b5237315
  - Note taken on [2020-03-26 Thu 09:33] \\
    https://www.unisonweb.org/
  - Note taken on [2020-03-26 Thu 09:33] \\
    https://www.reddit.com/r/haskell/comments/fov9gt/closure_calculus_is_better_than_the_pure_%CE%BBcalculus/fljg9fb/
** Number hierarchy
   - Note taken on [2020-06-13 Sat 17:19] \\
     Twitter survey on natural https://twitter.com/christopherdone/status/1271781700083818496
   - Note taken on [2020-06-13 Sat 17:03] \\
     Functions which have Int in them:

     #+BEGIN_SRC haskell
     Prelude/Data.List/Data.Vector/Data.Map:
     (!!) :: [a] -> Int -> a
     replicate :: Int -> a -> [a]
     take :: Int -> [a] -> [a]
     drop :: Int -> [a] -> [a]
     splitAt :: Int -> [a] -> ([a], [a])
     #+END_SRC
Natural   -- 123
Integer   -- 123 -123
Decimal 2 -- 123 -123 123.12 -123.12

Identification:

#+BEGIN_SRC haskell
123 :: Natural
-123 :: Integer
123.12 :: Decimal 2
123.1 :: Decimal 1
#+END_SRC

#+BEGIN_SRC haskell
class FromInteger n where fromInteger :: Integer -> n
class FromDecimal i n where fromDecimal :: Decimal i -> n

instance FromInteger Integer
instance FromInteger (Decimal n)

instance FromDecimal subset (Decimal superset) where subset <= superset
  -- e.g. fromDecimal (1.1 :: Decimal 1) :: Decimal 2
#+END_SRC
* Mantras
** UI failures
- "The CSRF token has expired." refuses to login. Users don't know WTF
  a CSRF token is, and nor do they care.
- "Generically failed, please refresh" crap like [[file+emacs:org/mantras-ui-failure.png][this]] mailgun failure
- Scroll within scroll
- Focus stealing
* DigitalOcean
  - Note taken on [2020-06-12 Fri 13:29] \\
    We to block e.g. http://134.209.20.251:30909/
  - Note taken on [2020-04-14 Tue 10:55] \\
    externalTrafficPolicy is the key trick:

    http://64.227.44.55:30909/ =>

    #+BEGIN_SRC
    remoteHost = 109.175.148.125:56616,
    #+END_SRC

    https://inflex.io/ =>

    #+BEGIN_SRC
    remoteHost = 10.106.0.4:39350,
    #+END_SRC

    We can set an environment variable like ACCEPT_CIDR and make a Wai
    middleware which will only accept connections from IPs which are
    within that CIDR.
  - Note taken on [2020-04-04 Sat 10:29] \\
    Load balancer name issue:

    https://cloudsupport.digitalocean.com/s/my-tickets
  - Note taken on [2020-03-29 Sun 18:11] \\
    Consider e.g. rancher or coreos - a way to spin up a droplet with a
    single file like "run this docker image".
  - Note taken on [2020-03-29 Sun 17:45] \\
    Got a basic deploy working with DO's load balancer (with HTTPS), a
    single droplet (a heavy full ubuntu machine with docker-machine on
    it).

    Deploy step is basically:

    docker-machine up -d

    And we change the docker image to something else to deploy a new instance.
  - Note taken on [2020-03-29 Sun 17:10] \\
    Via docker-machine:

    time docker-machine create   --driver digitalocean   --digitalocean-access-token $(cat ~/.do-token)   --digitalocean-monitoring   --digitalocean-region "lon1"   --digitalocean-size "s-1vcpu-1gb" inflex-server
  - Note taken on [2020-03-29 Sun 12:36] \\
    Looks like this guy has it right:

    https://www.digitalocean.com/community/questions/kubernetes-deployment-with-external-load-balancer-zero-downtime-rollouts
- [ ] Proxying http://hackage.haskell.org/package/warp-3.3.9/docs/Network-Wai-Handler-Warp.html#v:setProxyProtocolRequired
#+BEGIN_SRC
chris@precision:~$ doctl auth init
Please authenticate doctl for use with your DigitalOcean account. You can generate a token in the control panel at https://cloud.digitalocean.com/account/api/token

Enter your access token:
Validating token... OK

chris@precision:~$ doctl kubernetes cluster kubeconfig save inflex-server
Notice: Adding cluster credentials to kubeconfig file found in "/home/chris/.kube/config"
Notice: Setting current-context to do-lon1-inflex-server
chris@precision:~$
#+END_SRC
* Security
  - Note taken on [2020-06-19 Fri 11:17] \\
    Add a backup domain for the API part of the service?
    E.g. inflex-io.com or inflex-api.com

    #+BEGIN_QUOTE
    In hindsight, using a .IO domain for our core APIs was not a great
    choice. The outage on September 20th showed how severe the problems
    and support infrastructure are. Based on our experience we would
    advise against using a .IO domain name if availability is important.

    To work around the DNS issue, Stream’s API traffic now runs on a .com
    domain name. The site still runs on .io since this is harder to change
    and not as critical in terms of uptime. To further improve reliability
    we’re considering:

    Adding a backup .ORG domain name.
    Using a backup DNS provider for either the .COM or .ORG domain name.
    Implementing client-side DNS failover in our SDKs.
    #+END_QUOTE

    https://hackernoon.com/stop-using-io-domain-names-for-production-traffic-b6aa17eeac20

* References
  - Note taken on [2020-06-07 Sun 19:00] \\
    Type Inference with Polymorphic Recursion
    http://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.42.3091&rep=rep1&type=pdf
  - Note taken on [2020-06-07 Sun 12:19] \\
    #+BEGIN_SRC
    -- So for both Hugs and GHC, a recursive type is not generalized
    -- inferred.  You need a type signature.

    -- ERROR "inflex-lang/src/Q.hs":4 - Type error in application
    -- *** Expression     : f (n - 1) 'a'
    -- *** Term           : 'a'
    -- *** Type           : Char
    -- *** Does not match : ()

    -- • Couldn't match expected type ‘()’ with actual type ‘Char’
    --      • In the second argument of ‘f’, namely ‘'a'’
    --        In the expression: f (n - 1) 'a'

    f :: Int -> a -> Int
    f 0 x = 0
    f 1 x = f 0 ()
    f n x = f (n-1) 'a'
    #+END_SRC
  - Note taken on [2020-06-07 Sun 11:23] \\
    http://reasonableapproximation.net/2019/05/05/hindley-milner.html
  - Note taken on [2020-06-07 Sun 11:16] \\
    Type classes: confluence, coherence and global uniqueness
    http://blog.ezyang.com/2014/07/type-classes-confluence-coherence-global-uniqueness/
  - Note taken on [2020-06-07 Sun 11:15] \\
    Rust trait coherence

    https://doc.rust-lang.org/reference/items/implementations.html#trait-implementation-coherence
  - Note taken on [2020-06-07 Sun 11:09] \\
    Haskell with only one typeclass http://okmij.org/ftp/Haskell/TypeClass.html#Haskell1
  - Note taken on [2020-06-07 Sun 11:05] \\
    Algorithmically Scrapping Your Typeclasses
    https://reasonablypolymorphic.com/blog/algorithmic-sytc/
  - Note taken on [2020-06-07 Sun 11:04] \\
    Typing Haskell in Haskell https://gist.github.com/chrisdone/0075a16b32bfd4f62b7b#ambiguity-and-defaults
  - Note taken on [2020-06-07 Sun 11:02] \\
    Type class vs the world https://www.youtube.com/watch?v=hIZxTQP1ifo
  - Note taken on [2020-06-07 Sun 11:01] \\
    http://www.cs.bu.edu/techreports/pdf/1993-019-recursivetype.pdf
  - Note taken on [2020-06-07 Sun 11:01] \\
    http://ropas.snu.ac.kr/lib/dock/He1993.pdf
  - Note taken on [2020-06-07 Sun 11:01] \\
    https://pchiusano.github.io/2018-02-13/typeclasses.html
